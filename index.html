<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PORTAL GOV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(180deg,#0a7a3d,#f4c430);
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:420px;
  padding:14px;
}
.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.35);
}
h1,h2,h3{text-align:center;color:#0a7a3d}
button,input{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  background:linear-gradient(135deg,#0a7a3d,#f4c430);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
.red{background:#e74c3c}
.gray{background:#ddd;color:#222}
.box{
  background:#f7fdf9;
  border-radius:14px;
  padding:12px;
  margin:10px 0;
}
.hidden{display:none}
.valor{
  font-size:22px;
  font-weight:700;
  color:#e60000;
  animation:p 1s infinite;
}
@keyframes p{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
.logo{
  display:block;
  margin:0 auto 10px;
  width:90px;
}
</style>
</head>

<body>
<div class="app">
<div class="card">

<!-- HOME -->
<div id="home">
<img src="https://upload.wikimedia.org/wikipedia/commons/1/1f/Brasao_oficial_do_Brasil.png" class="logo">
<h1>PORTAL GOV</h1>
<button id="btnAcessar">ğŸ” Acessar</button>
</div>

<!-- LOGIN -->
<div id="login" class="hidden">
<h2>Login</h2>
<input id="luser" placeholder="Login">
<input id="lpass" type="password" placeholder="Senha">
<button id="btnEntrar">Entrar</button>
<button class="gray" id="btnVoltar">Voltar</button>
<p id="msg"></p>
</div>

<!-- PAINEL -->
<div id="painel" class="hidden">
<img src="https://upload.wikimedia.org/wikipedia/commons/1/1f/Brasao_oficial_do_Brasil.png" class="logo">
<h2 id="titulo"></h2>

<div class="box">
Saldo disponÃ­vel:<br>
<span id="saldo" class="valor"></span><br>
Bloqueado: R$ <span id="bloq"></span>
</div>

<div class="box">
<h3>ğŸ“Š INDICADORES</h3>
<div id="indicadores"></div>
<button id="btnCriarIndicador" class="hidden">â• Criar</button>
<button id="btnEditarIndicador" class="hidden">âœï¸ Editar</button>
</div>

<div class="box hidden" id="boxFundador">
<h3>ğŸ‘‘ FUNDADOR</h3>
<button id="btnCriarSenhaNB">ğŸ” Criar/Alterar senha NB</button>
<button id="btnBloquearNB" class="red">ğŸš« Bloquear NB</button>
</div>

<button id="btnNBDados">ğŸ”‘ NB DADOS</button>
<button class="red" id="btnSair">ğŸšª Sair</button>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, get, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAE-c6y2Z1JsQplCfj1UNW7Wyr4ssCsJQU",
  authDomain: "tse-painel.firebaseapp.com",
  databaseURL: "https://tse-painel-default-rtdb.firebaseio.com",
  projectId: "tse-painel",
  storageBucket: "tse-painel.firebasestorage.app",
  messagingSenderId: "818733405394",
  appId: "1:818733405394:web:8e3e3e45062e3122e9490b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* CONFIG */
const FUNDADOR_LOGIN = "FUNDADOR";
const FUNDADOR_SENHA = "2007";
let modoNB = false;

/* TELAS */
function tela(id){
  ["home","login","painel"].forEach(t=>document.getElementById(t).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function moeda(v){
  return v.toLocaleString("pt-BR",{minimumFractionDigits:2});
}

/* INIT */
async function init(){
  const snap = await get(ref(db,"contas"));
  let contas = snap.val() || [];
  if(!Array.isArray(contas)) contas = Object.values(contas);

  if(!contas.find(c=>c.login===FUNDADOR_LOGIN)){
    contas.push({
      login:FUNDADOR_LOGIN,
      senha:FUNDADOR_SENHA,
      tipo:"Fundador",
      saldo:1000000000,
      bloq:0
    });
    await set(ref(db,"contas"),contas);
  }
}
init();

/* LOGIN */
btnEntrar.onclick = async ()=>{
  const l=luser.value.trim(), p=lpass.value.trim();
  const snap=await get(ref(db,"contas"));
  let contas=snap.val()||[];
  if(!Array.isArray(contas)) contas=Object.values(contas);
  const u=contas.find(c=>c.login===l && c.senha===p);
  if(!u){msg.innerText="Acesso negado";return;}
  localStorage.setItem("user",u.login);
  carregar();
};

/* PAINEL */
function carregar(){
  const login=localStorage.getItem("user");
  tela("painel");

  onValue(ref(db,"contas"),snap=>{
    let contas=snap.val()||[];
    if(!Array.isArray(contas)) contas=Object.values(contas);
    const u=contas.find(c=>c.login===login);
    if(!u) return;

    titulo.innerText=u.tipo+" â€“ "+u.login;
    saldo.innerText="R$ "+moeda(u.saldo);
    bloq.innerText=moeda(u.bloq);
    boxFundador.classList.toggle("hidden",u.tipo!=="Fundador");
    carregarIndicadores(login);
  });
}

/* INDICADORES */
function carregarIndicadores(login){
  onValue(ref(db,`indicadores/${login}`),snap=>{
    indicadores.innerHTML="";
    const dados=snap.val()||{};
    for(const id in dados){
      indicadores.innerHTML+=`${dados[id].nome}: <b>${dados[id].valor}</b><br>`;
    }
  });
}

/* NB DADOS */
btnNBDados.onclick = async ()=>{
  const s=prompt("Senha NB:");
  const snap=await get(ref(db,"config/nb"));
  if(!snap.exists() || snap.val()!==s) return alert("Senha invÃ¡lida");

  modoNB=true;
  btnCriarIndicador.classList.remove("hidden");
  btnEditarIndicador.classList.remove("hidden");
};

/* CRIAR */
btnCriarIndicador.onclick = async ()=>{
  if(!modoNB) return;
  const nome=prompt("Nome:");
  const valor=prompt("Valor:");
  if(!nome||valor===null) return;
  await set(push(ref(db,`indicadores/${localStorage.getItem("user")}`)),{nome,valor});
};

/* EDITAR */
btnEditarIndicador.onclick = async ()=>{
  if(!modoNB) return;
  const r=ref(db,`indicadores/${localStorage.getItem("user")}`);
  const s=await get(r);
  const d=s.val()||{};
  for(const id in d){
    const n=prompt(d[id].nome,d[id].valor);
    if(n!==null) d[id].valor=n;
  }
  await set(r,d);
};

/* FUNDADOR */
btnCriarSenhaNB.onclick = async ()=>{
  const n=prompt("Nova senha NB:");
  if(!n) return;
  await set(ref(db,"config/nb"),n);
  alert("Senha NB atualizada");
};

btnBloquearNB.onclick = async ()=>{
  await set(ref(db,"config/nb"),"BLOQUEADO");
  alert("NB BLOQUEADO");
};

/* EVENTOS */
btnAcessar.onclick=()=>tela("login");
btnVoltar.onclick=()=>tela("home");
btnSair.onclick=()=>{localStorage.clear();tela("home");};
</script>

</body>
</html>
